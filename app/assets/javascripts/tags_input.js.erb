var tagWordsOriginInputId = '#task_tag_words';
var tagWordsInputId = '#task_tag_words_tag';

var tagCandidates = [
  'aaa',
  'abb',
  'abc',
  'bbb',
  'baa',
  'bba',
  'ccc',
  'cab'
];

var activateTagsInput = function(element) {
  var d = new $.Deferred;

  $(element).tagsInput({
    defaultText: '',
    width: '100%',
    height: 'inherit',
    delimiter: [' ']
  });

  d.resolve();
  return d.promise();
};

var activateAutoCompletion = function(element) {
  var d = new $.Deferred;

  $(element).autocomplete({
    source: tagCandidates,
    open: function() { $('.ui-menu').width(260) }
  });

  d.resolve();
  return d.promise();
};

var prepareTagsInput = function() {
  if ( $(tagWordsOriginInputId).attr('value') ) {
    activateTagsInput($(tagWordsOriginInputId))
      .then(function() {
        activateAutoCompletion($(tagWordsInputId));
      });
  } else {
    $(tagWordsOriginInputId).on('focusin', function() {
      activateTagsInput(this)
        .then(function() {
          activateAutoCompletion(tagWordsInputId);
        })
        .then(function() {
          $(tagWordsInputId).focus();
        });
    });
  }
};

var setupTagsInput = function() {
  if ( $(tagWordsOriginInputId).length ) {
    prepareTagsInput();
  }
};
